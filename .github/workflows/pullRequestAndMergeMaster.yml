name: PullRequestAndMergeMaster
on:
  push:
    branches:
      - master
  pull_request:

jobs:
  CreateAndPushWindowsExecutable:
    name: CreateAndPushWindowsExecutable
    runs-on: windows-2019
    strategy:
      matrix:
        goarch: [ amd64 ]
    steps:
    - uses: actions/checkout@v4
    - uses: actions/setup-go@v5
      with:
        go-version-file: "go.mod"
    - name: Setting EnvVariable to checkout newLine char properly
      shell: bash
      run: |
        git config --system core.autocrlf false
        git config --system core.eol lf
    - name: Test and Build
      shell: powershell
      run: |
        $ErrorView = 'NormalView'
        [Environment]::SetEnvironmentVariable("path", "$env:path;$env:GOPATH\bin", "Machine")
        .\win_build.ps1 -arch ${{ matrix.goarch }}
    - uses: actions/upload-artifact@v2
      with:
        name: binaries
        path: .\target\bin\windows_${{ matrix.goarch }}
